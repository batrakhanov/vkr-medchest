--
-- Script was generated by Devart dbForge Studio 2019 for MySQL, Version 8.1.45.0
-- Product home page: http://www.devart.com/dbforge/mysql/studio
-- Script date 11.06.2019 14:04:35
-- Server version: 5.5.5-10.1.40-MariaDB
-- Client version: 4.1
--

-- 
-- Disable foreign keys
-- 
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;

-- 
-- Set SQL mode
-- 
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;

-- 
-- Set character set the client will use to send SQL statements to the server
--
SET NAMES 'utf8';

DROP DATABASE IF EXISTS medchestdb;

CREATE DATABASE IF NOT EXISTS medchestdb
	CHARACTER SET utf8
	COLLATE utf8_general_ci;

--
-- Set default database
--
USE medchestdb;

--
-- Create table `medicine_form`
--
CREATE TABLE IF NOT EXISTS medicine_form (
  medicine_form_id INT(11) NOT NULL AUTO_INCREMENT,
  name VARCHAR(50) NOT NULL,
  unit_meas VARCHAR(50) NOT NULL,
  PRIMARY KEY (medicine_form_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 4,
AVG_ROW_LENGTH = 8192,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create table `medicine`
--
CREATE TABLE IF NOT EXISTS medicine (
  medicine_id BIGINT(20) NOT NULL AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL,
  storage_place VARCHAR(100) DEFAULT NULL,
  pcs DECIMAL(10, 2) DEFAULT NULL,
  dosage VARCHAR(255) DEFAULT NULL,
  price DECIMAL(19, 2) DEFAULT NULL,
  active_material VARCHAR(100) DEFAULT NULL,
  bar_code DECIMAL(20, 0) DEFAULT NULL,
  is_recipe_needed BIT(1) NOT NULL,
  medicine_form_id INT(3) NOT NULL,
  PRIMARY KEY (medicine_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 6,
AVG_ROW_LENGTH = 8192,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create foreign key
--
ALTER TABLE medicine 
  ADD CONSTRAINT FK_medicine_to_form FOREIGN KEY (medicine_form_id)
    REFERENCES medicine_form(medicine_form_id) ON DELETE NO ACTION;

--
-- Create table `user`
--
CREATE TABLE IF NOT EXISTS user (
  id BIGINT(20) NOT NULL AUTO_INCREMENT,
  username VARCHAR(255) NOT NULL,
  password VARCHAR(255) NOT NULL,
  name VARCHAR(50) NOT NULL,
  parent_id BIGINT(20) DEFAULT NULL,
  email VARCHAR(100) DEFAULT NULL,
  phone VARCHAR(50) DEFAULT NULL,
  confirmed_by_parent BIT(1) DEFAULT NULL,
  PRIMARY KEY (id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 7,
AVG_ROW_LENGTH = 16384,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create table `user_preferences`
--
CREATE TABLE IF NOT EXISTS user_preferences (
  user_preferences_id BIGINT(20) NOT NULL AUTO_INCREMENT,
  phone_notify BIT(1) DEFAULT NULL,
  email_notify BIT(1) DEFAULT NULL,
  user_id BIGINT(20) DEFAULT NULL,
  firebase_token VARCHAR(255) DEFAULT NULL,
  alert_days_to_expired INT(11) DEFAULT NULL,
  alert_critical_pcs_left INT(11) DEFAULT NULL,
  address VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (user_preferences_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 4,
AVG_ROW_LENGTH = 16384,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create foreign key
--
ALTER TABLE user_preferences 
  ADD CONSTRAINT FK_user_pref_to_user FOREIGN KEY (user_id)
    REFERENCES user(id) ON DELETE NO ACTION;

--
-- Create table `recipe`
--
CREATE TABLE IF NOT EXISTS recipe (
  recipe_id BIGINT(20) NOT NULL AUTO_INCREMENT,
  author VARCHAR(255) DEFAULT NULL,
  medicine_id BIGINT(20) NOT NULL,
  issue_date DATE NOT NULL,
  valid_date DATE NOT NULL,
  is_used BIT(1) NOT NULL,
  comment VARCHAR(255) DEFAULT NULL,
  user_id BIGINT(20) NOT NULL,
  PRIMARY KEY (recipe_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 4,
AVG_ROW_LENGTH = 8192,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create foreign key
--
ALTER TABLE recipe 
  ADD CONSTRAINT FK_recipe_to_medicine FOREIGN KEY (medicine_id)
    REFERENCES medicine(medicine_id) ON DELETE NO ACTION;

--
-- Create foreign key
--
ALTER TABLE recipe 
  ADD CONSTRAINT FK_recipe_to_user FOREIGN KEY (user_id)
    REFERENCES user(id) ON DELETE NO ACTION;

--
-- Create table `medicine_item`
--
CREATE TABLE IF NOT EXISTS medicine_item (
  medicine_item_id BIGINT(20) NOT NULL AUTO_INCREMENT,
  medicine_id BIGINT(20) NOT NULL,
  expired DATE DEFAULT NULL,
  days_open INT(11) DEFAULT NULL,
  dosage VARCHAR(100) DEFAULT NULL,
  pcs_left DECIMAL(10, 2) DEFAULT NULL,
  user_id BIGINT(20) DEFAULT NULL,
  PRIMARY KEY (medicine_item_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 26,
AVG_ROW_LENGTH = 1638,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create foreign key
--
ALTER TABLE medicine_item 
  ADD CONSTRAINT FK_medicine_item_to_user FOREIGN KEY (user_id)
    REFERENCES user(id) ON DELETE NO ACTION;

--
-- Create foreign key
--
ALTER TABLE medicine_item 
  ADD CONSTRAINT FK_meditem_to_medicine FOREIGN KEY (medicine_id)
    REFERENCES medicine(medicine_id) ON DELETE CASCADE;

--
-- Create table `course`
--
CREATE TABLE IF NOT EXISTS course (
  course_id BIGINT(20) NOT NULL AUTO_INCREMENT,
  user_id BIGINT(20) NOT NULL,
  medicine_id BIGINT(20) NOT NULL,
  begin_date DATE NOT NULL,
  end_date DATE NOT NULL,
  PRIMARY KEY (course_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 21,
AVG_ROW_LENGTH = 5461,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create foreign key
--
ALTER TABLE course 
  ADD CONSTRAINT FK_course_medicine_id FOREIGN KEY (medicine_id)
    REFERENCES medicine(medicine_id) ON DELETE NO ACTION;

--
-- Create foreign key
--
ALTER TABLE course 
  ADD CONSTRAINT FK_course_to_user FOREIGN KEY (user_id)
    REFERENCES user(id) ON DELETE NO ACTION;

--
-- Create table `graph`
--
CREATE TABLE IF NOT EXISTS graph (
  graph_id BIGINT(20) NOT NULL AUTO_INCREMENT,
  course_id BIGINT(20) DEFAULT NULL,
  plan_take_date DATETIME NOT NULL,
  doze DECIMAL(10, 2) DEFAULT NULL,
  fact_take_date DATETIME DEFAULT NULL,
  is_before_eat BIT(1) NOT NULL,
  is_after_eat BIT(1) NOT NULL,
  is_done BIT(1) NOT NULL,
  PRIMARY KEY (graph_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 219,
AVG_ROW_LENGTH = 431,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create foreign key
--
ALTER TABLE graph 
  ADD CONSTRAINT FK_graph_to_course FOREIGN KEY (course_id)
    REFERENCES course(course_id) ON DELETE CASCADE;

--
-- Create table `notification_type`
--
CREATE TABLE IF NOT EXISTS notification_type (
  notification_type_id SMALLINT(6) NOT NULL AUTO_INCREMENT,
  name VARCHAR(50) DEFAULT NULL,
  PRIMARY KEY (notification_type_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 3,
AVG_ROW_LENGTH = 8192,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create table `notification`
--
CREATE TABLE IF NOT EXISTS notification (
  notification_id BIGINT(20) NOT NULL AUTO_INCREMENT,
  notification_type_id SMALLINT(6) DEFAULT NULL,
  medicine_item_id BIGINT(20) DEFAULT NULL,
  date_sent DATE DEFAULT NULL,
  PRIMARY KEY (notification_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 6,
AVG_ROW_LENGTH = 5461,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create foreign key
--
ALTER TABLE notification 
  ADD CONSTRAINT FK_notification_to_item FOREIGN KEY (medicine_item_id)
    REFERENCES medicine_item(medicine_item_id) ON DELETE NO ACTION;

--
-- Create foreign key
--
ALTER TABLE notification 
  ADD CONSTRAINT FK_notification_to_type FOREIGN KEY (notification_type_id)
    REFERENCES notification_type(notification_type_id) ON DELETE NO ACTION;

-- 
-- Dumping data for table medicine_form
--
INSERT INTO medicine_form VALUES
(1, 'Таблетки', 'шт'),
(2, 'Капли', 'кап'),
(3, 'Раствор', 'мл');

-- 
-- Dumping data for table user
--
INSERT INTO user VALUES
(4, 'user1', '$2y$13$fiFXx1FUhDe4J.H01HwWFOu7/jJi/EXPuU6NXLqZUqmwxuwIpCTC2', 'Петр', 6, 'example@mail.ru', '+79080586789', NULL),
(5, 'user2', '$2y$13$m8K0GqEI3d4t36.CKNG0NeeLaANq8GGNYisQbA7UgLyysF/eWjKK2', 'Иван', NULL, NULL, NULL, NULL),
(6, 'user3', '$2y$13$Oacy1XjWuXnX3yrXGxJ.aeoHODuSSU3Nv9oPbfGHMCZrdd4ABDb/y', 'Ярополк', NULL, 'dahbka96@gmail.com', '+7955555555', NULL);

-- 
-- Dumping data for table medicine
--
INSERT INTO medicine VALUES
(1, 'Синупрет драже №50', 'В сухом темном помещении при температору от +5 до +25 градусов', 50.00, '2', 347.00, 'порошок корня горечавки 6 мг + порошок цветков первоцвета 18 мг + порошок травы щавеля 18 мг + порош', NULL, False, 1),
(2, 'Амбробене таблетки 30мг №20 (Амброксол)', 'Хранить при температуре не выше 25 °С.', 20.00, '1', 129.00, 'амброксол', NULL, False, 1),
(3, 'Фенибут таблетки 250мг №20 /олайнфарм/ ', 'Хранить при температуре не выше 25 градусов', 20.00, '1', 403.00, 'Аминофенилмасляная кислота', NULL, True, 1),
(4, 'Имодиум экспресс таблетки лиофилизат 2мг №6 (Лоперамид)', 'Хранить при температуре от 15 до 30 °С.', 6.00, '1', NULL, 'Лоперамида гидрохлорид', NULL, False, 1),
(5, 'Ацц 100 таблетки шипучие 100мг №20 ', 'Хранить при температуре не выше 25 °С.', 20.00, '3', NULL, 'Ацетилцистеин', NULL, False, 1);

-- 
-- Dumping data for table notification_type
--
INSERT INTO notification_type VALUES
(1, 'Об истечении срока годности'),
(2, 'Об истощении запасов препаратов');

-- 
-- Dumping data for table medicine_item
--
INSERT INTO medicine_item VALUES
(1, 1, '2021-07-11', NULL, '2', 50.00, 4),
(2, 2, '2020-05-09', NULL, '1', 20.00, 4),
(12, 2, '0000-00-00', NULL, '1', 12.00, 4),
(14, 1, '0000-00-00', NULL, '2', 25.00, 4),
(16, 2, '2020-10-24', NULL, '1', 7.00, 4),
(17, 1, '2021-11-15', NULL, '2', 43.00, 4),
(18, 3, '2019-08-07', NULL, '1', 10.00, 4),
(19, 3, '2021-11-16', NULL, '1', 5.00, 4),
(20, 4, '2022-02-22', NULL, '1', 6.00, 4),
(21, 4, '2021-11-15', NULL, '1', 2.00, 4),
(22, 5, '2021-08-11', NULL, '3', 20.00, 6),
(23, 5, '2019-06-16', NULL, '3', 15.00, 6),
(24, 4, '2021-07-27', NULL, '1', 7.00, 4),
(25, 3, '2020-06-20', NULL, '1', 0.00, 6);

-- 
-- Dumping data for table course
--
INSERT INTO course VALUES
(13, 6, 4, '2019-06-03', '2019-06-09'),
(14, 6, 3, '2019-06-13', '2019-06-21'),
(20, 4, 5, '2019-06-17', '2019-06-23');

-- 
-- Dumping data for table user_preferences
--
INSERT INTO user_preferences VALUES
(2, False, True, 6, 'dS5oXMYjLoI:APA91bFTAvkw7uzi1V-n1QC5v79kfExavYqotqn3lHRMx4UrrWSDb5L_Mg97E4by7Pnjg9P5mARUz_LvQUIT8hljteFurE4suJDiczymxpun_TkU3My9z2WErnyIIPkbvHTozSvXIJWg', 15, 30, 'Челябинск, Свердловский проспект д.51'),
(3, NULL, NULL, 4, NULL, 15, 30, NULL);

-- 
-- Dumping data for table recipe
--
INSERT INTO recipe VALUES
(2, 'Петров П.П.', 3, '2019-05-25', '2019-09-03', False, 'Еще один на него ', 4),
(3, 'Петров П.П.', 5, '2019-06-12', '2019-07-21', False, 'Зачем???', 4);

-- 
-- Dumping data for table notification
--
INSERT INTO notification VALUES
(1, 1, 12, '2019-06-06'),
(2, 1, 14, '2019-06-06'),
(3, 1, 23, '2019-06-06'),
(5, 2, 25, '2019-06-06');

-- 
-- Dumping data for table graph
--
INSERT INTO graph VALUES
(169, 13, '2019-06-03 17:05:00', 1.00, '2019-06-06 06:50:11', False, True, True),
(170, 13, '2019-06-03 13:00:00', 1.00, '2019-06-06 06:51:03', False, True, True),
(171, 13, '2019-06-03 18:00:00', 1.00, '2019-06-06 06:51:52', False, True, True),
(172, 13, '2019-06-04 08:00:00', 1.00, '2019-06-06 06:52:42', False, True, True),
(173, 13, '2019-06-04 13:00:00', 1.00, '2019-06-06 06:53:31', False, True, True),
(174, 13, '2019-06-04 18:00:00', 1.00, '2019-06-06 06:55:41', False, True, True),
(175, 13, '2019-06-05 08:00:00', 1.00, NULL, False, True, False),
(176, 13, '2019-06-05 13:00:00', 1.00, NULL, False, True, True),
(177, 13, '2019-06-05 18:00:00', 1.00, NULL, False, True, False),
(178, 13, '2019-06-06 08:00:00', 1.00, NULL, False, True, False),
(179, 13, '2019-06-06 13:00:00', 1.00, NULL, False, True, False),
(180, 13, '2019-06-06 18:00:00', 1.00, NULL, False, True, False),
(181, 13, '2019-06-07 08:00:00', 1.00, NULL, False, True, False),
(182, 13, '2019-06-07 13:00:00', 1.00, NULL, False, True, False),
(183, 13, '2019-06-07 18:00:00', 1.00, NULL, False, True, False),
(184, 13, '2019-06-08 08:00:00', 1.00, NULL, False, True, False),
(185, 13, '2019-06-08 13:00:00', 1.00, NULL, False, True, False),
(186, 13, '2019-06-08 18:00:00', 1.00, NULL, False, True, False),
(193, 14, '2019-06-13 08:00:00', 1.00, '2019-06-06 08:27:06', False, False, True),
(194, 14, '2019-06-13 16:00:00', 1.00, '2019-06-06 08:35:15', False, False, True),
(196, 14, '2019-06-14 16:00:00', 1.00, '2019-06-06 08:36:39', False, False, True),
(198, 14, '2019-06-15 16:00:00', 1.00, '2019-06-06 08:37:41', False, False, True),
(200, 14, '2019-06-16 16:00:00', 1.00, '2019-06-06 08:40:58', False, False, True),
(202, 14, '2019-06-17 16:00:00', 1.00, '2019-06-06 08:45:53', False, False, True),
(203, 14, '2019-06-18 08:00:00', 1.00, '2019-06-06 08:49:17', False, False, True),
(204, 14, '2019-06-18 16:00:00', 1.00, '2019-06-06 08:50:01', False, False, True),
(205, 14, '2019-06-19 08:00:00', 1.00, '2019-06-06 08:54:51', False, False, True),
(206, 14, '2019-06-19 16:00:00', 1.00, '2019-06-06 09:00:45', False, False, True),
(207, 14, '2019-06-20 08:00:00', 1.00, NULL, False, False, False),
(208, 14, '2019-06-20 16:00:00', 1.00, NULL, False, False, False),
(209, 14, '2019-06-21 08:00:00', 1.00, '2019-06-06 07:47:09', False, False, True),
(210, 14, '2019-06-21 16:00:00', 1.00, NULL, False, False, False),
(213, 20, '2019-06-17 08:00:00', 3.00, NULL, False, False, False),
(214, 20, '2019-06-18 08:00:00', 3.00, NULL, False, False, False),
(215, 20, '2019-06-19 08:00:00', 3.00, NULL, False, False, False),
(216, 20, '2019-06-20 08:00:00', 3.00, NULL, False, False, False),
(217, 20, '2019-06-21 08:00:00', 3.00, NULL, False, False, False),
(218, 20, '2019-06-22 08:00:00', 3.00, NULL, False, False, False);

-- 
-- Restore previous SQL mode
-- 
/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;

-- 
-- Enable foreign keys
-- 
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;